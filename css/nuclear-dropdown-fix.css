/**
 * NUCLEAR DROPDOWN FIX - ABSOLUTE LAST RESORT
 * This completely replaces native select dropdowns with custom ones
 * Use only when all other solutions fail
 */

/* STEP 1: Hide all native select dropdowns on mobile */
@media (max-width: 767px) {
    /* Hide native select appearance completely */
    select,
    .form-select {
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        appearance: none !important;
        background-image: none !important;
        background-color: white !important;
        border: 1px solid #ced4da !important;
        border-radius: 0.375rem !important;
        padding: 0.375rem 2.25rem 0.375rem 0.75rem !important;
        font-size: 1rem !important;
        line-height: 1.5 !important;
        color: #212529 !important;
        cursor: pointer !important;
        
        /* CRITICAL: Force containment */
        max-width: calc(100vw - 32px) !important;
        width: 100% !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
        
        /* Add custom dropdown arrow */
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right 0.75rem center !important;
        background-size: 16px 12px !important;
    }
    
    /* Force focus state */
    select:focus,
    .form-select:focus {
        border-color: #86b7fe !important;
        outline: 0 !important;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
    }
    
    /* CRITICAL: Force all containers to prevent overflow */
    html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
        width: 100vw !important;
        box-sizing: border-box !important;
    }
    
    .container-fluid,
    .container,
    .main-content,
    .row,
    .col,
    [class*="col-"],
    .form-group,
    .mb-3,
    .form-floating,
    form,
    div {
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
    }
    
    /* Force container padding */
    .container-fluid {
        padding-left: 16px !important;
        padding-right: 16px !important;
        max-width: 100vw !important;
        width: 100vw !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
    }
    
    /* NUCLEAR: Force every single element to be contained */
    * {
        max-width: 100vw !important;
        box-sizing: border-box !important;
    }
    
    /* Exception for table containers */
    .table-responsive {
        max-width: 100% !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    .table-responsive .table {
        max-width: none !important;
        min-width: 100% !important;
    }
    
    /* EMERGENCY: Hide horizontal scrollbar completely */
    ::-webkit-scrollbar:horizontal {
        display: none !important;
        width: 0 !important;
        height: 0 !important;
    }
    
    /* Firefox scrollbar hiding */
    html {
        scrollbar-width: none !important;
        scrollbar-color: transparent transparent !important;
    }
    
    /* IE/Edge scrollbar hiding */
    body {
        -ms-overflow-style: none !important;
    }
    
    /* Force viewport meta tag behavior */
    @viewport {
        width: device-width;
        initial-scale: 1;
        maximum-scale: 1;
        user-scalable: no;
    }
}

/* STEP 2: Custom dropdown styles for replacement */
.custom-dropdown {
    position: relative !important;
    display: inline-block !important;
    width: 100% !important;
    max-width: calc(100vw - 32px) !important;
    box-sizing: border-box !important;
}

.custom-dropdown-button {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0.375rem 2.25rem 0.375rem 0.75rem !important;
    font-size: 1rem !important;
    line-height: 1.5 !important;
    color: #212529 !important;
    background-color: #fff !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 0.75rem center !important;
    background-size: 16px 12px !important;
    border: 1px solid #ced4da !important;
    border-radius: 0.375rem !important;
    cursor: pointer !important;
    text-align: left !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
}

.custom-dropdown-menu {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 1000 !important;
    display: none !important;
    min-width: 100% !important;
    max-width: 100% !important;
    padding: 0.5rem 0 !important;
    margin: 0.125rem 0 0 !important;
    font-size: 1rem !important;
    color: #212529 !important;
    text-align: left !important;
    background-color: #fff !important;
    background-clip: padding-box !important;
    border: 1px solid rgba(0, 0, 0, 0.15) !important;
    border-radius: 0.375rem !important;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.175) !important;
    box-sizing: border-box !important;
    overflow-y: auto !important;
    max-height: 200px !important;
}

.custom-dropdown-menu.show {
    display: block !important;
}

.custom-dropdown-item {
    display: block !important;
    width: 100% !important;
    padding: 0.25rem 1rem !important;
    clear: both !important;
    font-weight: 400 !important;
    color: #212529 !important;
    text-align: inherit !important;
    text-decoration: none !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    background-color: transparent !important;
    border: 0 !important;
    cursor: pointer !important;
    box-sizing: border-box !important;
}

.custom-dropdown-item:hover,
.custom-dropdown-item:focus {
    color: #1e2125 !important;
    background-color: #e9ecef !important;
}

.custom-dropdown-item.active {
    color: #fff !important;
    background-color: #0d6efd !important;
}

/* STEP 3: Force all elements to respect boundaries */
@media (max-width: 767px) {
    /* Absolute positioning fix for any remaining elements */
    * {
        position: relative !important;
    }
    
    *:not(.table):not(.table *) {
        max-width: 100vw !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
    }
    
    /* Force clip any overflowing content */
    body {
        clip: rect(0, 100vw, 100vh, 0) !important;
        -webkit-clip-path: inset(0 0 0 0) !important;
        clip-path: inset(0 0 0 0) !important;
    }
}